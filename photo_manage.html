<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>微信 房产管理后台</title>
<link rel="stylesheet" href="css/styler.css" type="text/css" />
</head>
<body>
<!-- 头部 【【-->
<div class="header">
  <div class="com-cent">
    <div class="hd-title">微信 房产管理后台</div>
    <div class="hd-log">欢迎你<span>亲爱的<em id="unm"></em>用户</span><a href="logout.php">退出</a></div>
    <ul class="hd-link">
      <li><a href="index.html">首页</a></li>
      <li class="curr"><a href="property_manage.html">管理后台</a></li>
      <li><a href="data.html">数据统计</a></li>
    </ul>
  </div>
</div>
<!-- 头部 】】-->
<!-- 二级菜单【【 -->
<div class="box-menu">
  <div class="com-menu">
    <ul class="menu">
      <li><a href="property_manage.html">楼盘管理</a></li>
      <li><a href="house_manage.html">看房团管理</a></li>
      <li><a href="#none" onmouseover="mopen('m1')" onmouseout="mclosetime()">楼盘印象管理</a>
        <ul class="menu-xia" style="visibility:hidden;" id="m1" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
          <li><a href="impression_inquiry.html">房友印象查询</a></li>
          <li><a href="impression_set.html">房友印象设置</a></li>
          <li><a href="review.html">专家点评管理</a></li>
        </ul>
      </li>
      <li><a href="order_li.html" onmouseover="mopen('m2')" onmouseout="mclosetime()">认筹管理</a>
        <ul class="menu-xia" style="visibility:hidden;" id="m2" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
          <li><a href="order_li.html">认筹列表</a></li>
          <li><a href="order.html">认筹订单</a></li>
        </ul>
      </li>
      <li class="curr"><a href="photo_inquiry.html" onmouseover="mopen('m3')" onmouseout="mclosetime()">照片管理</a>
        <ul class="menu-xia" style="visibility:hidden;" id="m3" onmouseover="mcancelclosetime()" onmouseout="mclosetime()">
          <li><a href="photo_inquiry.html">照片查询</a></li>
          <li><a href="photo_manage.html">照片管理</a></li>
        </ul>
      </li>
      <li><a href="new.html">多页态</a></li>
    </ul>
  </div>
</div>  
<!-- 二级菜单 】】 -->
<div class="cent-auto">
    <!-- 照片墙查询【【 -->
    <div class="com-min">
      <h3>照片墙查询</h3>
      <div class="box-table" id="tbl_1">
      </div>
    </div>
    <!-- 照片墙查询 】】-->
    <!-- 添加图片【【-->
    <div class="com-min hide" id="ed_1">
      <h3>编辑图片</h3>
      <div class="tipe-lb"><label>图片组名称：</label> <input class="inp-tex inp-300" id="ed_1_v1" type="text" onchange="setName()" /></div>
      <!--div class="tipe-lb"><label>图片组布局：</label>
        <select size="1" class="li-hd">
          <option>六宫格</option>
          <option>0:00</option>
        </select>
      </div-->
      <div class="tipe-lb"><label>图片组编辑：</label> 
        <ul class="six-box">
          <li><button class="btn-cha" type="button" onclick="show_1();">编辑标题</button></li> 
          <li><button class="btn-cha" type="button" onclick="show_2();">编辑图片</button> <br />尺寸建议260*150</li>
          <li><button class="btn-cha" type="button" onclick="show_3();">编辑图片</button> <br />尺寸建议120*150</li>
          <li><button class="btn-cha" type="button" onclick="show_4();">编辑图片</button> <br />尺寸建议220*150</li>   
          <li><button class="btn-cha" type="button" onclick="show_5();">编辑简要</button></li>
          <li><button class="btn-cha" type="button" onclick="show_6();">编辑图片</button> <br />尺寸建议100*150</li> 
        </ul>
      </div>
    </div>
    
    <div class="com-min hide" id="lp_tj">
        <h3>提交</h3>
        <div class="tipe-lb"><label>.</label> <button class="btn-cha" type="button" onclick="do_commit()";>提交审核</button> </div> 
    </div>
    <!-- 添加图片 】】-->
</div>

<!-- 添加标题 【【-->
<div class="box-layer hide" id="b1">
  <div class="title"><h2>添加标题</h2></div>
  <a class="close" href="javascript:hide_b1();" title="关闭">关闭</a>
  <div class="tip-mian">
    <div class="p-shuju">
      <div class="layer-lb"><label>主标题：</label> <input class="inp-tex inp-300" id="bt1" type="text" /></div>
      <div class="layer-lb"><label>副标题：</label> <input class="inp-tex inp-300" id="bt2" type="text" /></div>
    </div>
    <div class="but-auto"><a class="an-butn" href="javascript:setTitle();" title="确认">确认</a> <a class="an-butn" href="javascript:hide_b1();" title="取消">取消</a></div>
  </div>
</div>
<!--  添加标题 】】 -->

<!-- 添加简述 【【-->
<div class="box-layer hide" id="b2">
  <div class="title"><h2>添加简述</h2></div>
  <a class="close" href="javascript:hide_b2();" title="关闭">关闭</a>
  <div class="tip-mian">
    <div class="p-shuju">
      <div class="layer-lb"><label>简述正文：</label> <textarea class="layer-100" id="zw" cols="" rows="">100个字以内</textarea></div>
    </div>
    <div class="but-auto"><a class="an-butn" href="javascript:setDes();" title="确认">确认</a> <a class="an-butn" href="javascript:hide_b2();" title="取消">取消</a></div>
  </div>
</div>
<!--  添加简述 】】 -->

<!-- 上传图片 【【-->
<div class="box-layer hide" id="b3">
  <div class="title"><h2>上传图片</h2></div>
  <a class="close" href="javascript:hide_b3();" title="关闭">关闭</a>
  <div class="tip-mian">
    <div class="p-shuju" id="up1">      
    </div>
  </div>
</div>
<!--  上传图片 】】 -->

<div class="hide">
	<form method="post" id="fm" target="forsubmit" >
    	<textarea class="layer-100" id="v_31" name="v_31"></textarea>
    </form>
    <iframe name="forsubmit" id="ifram_sign" src="" height="0" width="0" style="display:none;" ></iframe>
</div>

</body>
</html>
<script language="javascript" src="js/xl.js" charset="utf-8"></script>
<script language="javascript" src="js/jquery-2.0.3.js"></script>
<script language="javascript" src="js/comm.js" charset="utf-8"></script>
<script language="javascript" src="alldata.php" charset="utf-8"></script>
<script language="javascript" src="js/json.js"></script>
<script language="javascript" >

var g_cur_bid = 0;
var g_cur_hcid = 0;

function hide_b1()
{
	$("#b1").addClass("hide");
}
function hide_b2()
{
	$("#b2").addClass("hide");
}
function hide_b3()
{
	$("#b3").addClass("hide");
}

function show_1()
{
	move_win( "b1", "ed_1" );
	$("#b1").removeClass("hide");
	
	var o = get_hc_json();
	
	for ( var j=0; j<o.d.length; j++ )
	{
		if ( o.d[j].id == g_cur_hcid )
		{
			$("#bt1").val( o.d[j].ps1[0].title );
			$("#bt2").val( o.d[j].ps1[0].subTitle );
			break;
		}
	}
}

function show_2()
{
	move_win( "b3", "ed_1" );
	$("#b3").removeClass("hide");
	$( "#up1" ).html( str_html_uploadform( getImgUrl(1) ) + '<div class="layer-lb font-12">(请上传JPG格式图片，大小100K以内，尺寸建议120*150，图片名不超过六个字)</div>' );
}

function show_3()
{
	move_win( "b3", "ed_1" );
	$("#b3").removeClass("hide");
	$( "#up1" ).html( str_html_uploadform( getImgUrl(2) ) + '<div class="layer-lb font-12">(请上传JPG格式图片，大小100K以内，尺寸建议120*150，图片名不超过六个字)</div>' );
}

function show_4()
{
	move_win( "b3", "ed_1" );
	$("#b3").removeClass("hide");
	$( "#up1" ).html( str_html_uploadform( getImgUrl(3) ) + '<div class="layer-lb font-12">(请上传JPG格式图片，大小100K以内，尺寸建议120*150，图片名不超过六个字)</div>' );
}

function show_5()
{
	move_win( "b2", "ed_1" );
	$("#b2").removeClass("hide");
	
	var o = get_hc_json();
	
	for ( var j=0; j<o.d.length; j++ )
	{
		if ( o.d[j].id == g_cur_hcid )
		{
			$("#zw").val( o.d[j].ps2[1].content );
			break;
		}
	}
}

function show_6()
{
	move_win( "b3", "ed_1" );
	$("#b3").removeClass("hide");
	$( "#up1" ).html( str_html_uploadform( getImgUrl(5) ) + '<div class="layer-lb font-12">(请上传JPG格式图片，大小100K以内，尺寸建议120*150，图片名不超过六个字)</div>' );
}

function getImgUrl( idx )
{
	return "../building/" + g_cur_bid + "/img/hc/" + g_cur_hcid + "_" + idx + ".jpg";
}

function get_hc_json()
{
	return $("#v_31").html().parseJSON();
}

function set_hc_json( v )
{
	for ( var i=0; i<g_data.length; i++ )
	{
		if ( g_cur_bid == g_data[i][0] )
		{
			g_data[i][28] = v.toJSONString();
			$("#v_31").html( g_data[i][28] );
		}
	}
}

function setName()
{
	var o = get_hc_json();
	
	for ( var j=0; j<o.d.length; j++ )
	{
		if ( o.d[j].id == g_cur_hcid )
		{
			o.d[j].title = $("#ed_1_v1").val();
			break;
		}
	}
	
	set_hc_json( o );
	init_hclist(g_cur_bid);
}

function setTitle()
{
	var o = get_hc_json();
	
	for ( var j=0; j<o.d.length; j++ )
	{
		if ( o.d[j].id == g_cur_hcid )
		{
			o.d[j].ps1[0].title = $("#bt1").val();
			o.d[j].ps1[0].subTitle = $("#bt2").val();
			break;
		}
	}
	
	set_hc_json( o );
	hide_b1();
}

function setDes()
{
	var o = get_hc_json();
	
	for ( var j=0; j<o.d.length; j++ )
	{
		if ( o.d[j].id == g_cur_hcid )
		{
			o.d[j].ps2[1].content = $("#zw").val();
			break;
		}
	}
	
	set_hc_json( o );
	hide_b2();
}

function init_lplist()
{
	var v = { "th":[ "楼盘ID", "楼盘名称", "提交时间", "状态", "操作" ], "td":[] };
	
	for ( var i=0; i<g_data.length; i++ )
	{
		v.td[i] = [];
		v.td[i].push( g_data[i][0] );
		v.td[i].push( g_data[i][1] );
		v.td[i].push( "2013-09-24" );
		v.td[i].push( "待审核" );
		v.td[i].push( a_html( "编辑", "javascript:init_hclist('" + g_data[i][0] + "')" ) );
	}
	$("#tbl_1").html( create_tblbyjson( v ) );
}

function init_hclist( bid )
{
	g_cur_bid = bid;
	
	var v = { "th":[ "楼盘名称", "图片组名称", "操作" ], "td":[] };

	for ( var i=0; i<g_data.length; i++ )
	{
		if ( bid == g_data[i][0] )
		{
			var o = g_data[i][28].parseJSON();
			for ( var j=0; j<o.d.length; j++ )
			{
				v.td[j] = [];
				v.td[j].push( g_data[i][1] );
				v.td[j].push( o.d[j].title );
				v.td[j].push( a_html("编辑","javascript:edit_hc('" + o.d[j].id + "')") + a_html("删除","javascript:del_hc('" + o.d[j].id + "')") );
			}
			$("#v_31").html( g_data[i][28] );
		}
	}
	
	$("#tbl_1").html( create_tblbyjson( v )+'<div class="but-righ ma-top"><button class="btn-cha" type="button" onclick="add_hc()">添加新画册</button></div>' );
}

function show_edit( v )
{
	$("#ed_1").removeClass( "hide" );
	$("#lp_tj").removeClass( "hide" );
	$("#ed_1_v1").val( v.title );
}

function edit_hc( id )
{
	for ( var i=0; i<g_data.length; i++ )
	{
		if ( g_cur_bid == g_data[i][0] )
		{
			var o = g_data[i][28].parseJSON();
			for ( var j=0; j<o.d.length; j++ )
			{
				if ( id == o.d[j].id )
				{
					g_cur_hcid = id;
					show_edit( o.d[j] );
					init_hclist( g_cur_bid );
					return;
				}
			}
			break;
		}
	}
	alert( "匹配出错，请刷新页面!" );
}

function add_hc()
{
	// 八宫格
/*
	var v = {"title":"","id":"","ps1":[{"size":[150, 150],"type":"title","title": "","subTitle":""},{"size": [260, 150],"type": "img","name": "","img": ""},{"size": [100, 150],"type": "img","name": "","img": ""},{"size": [200, 150],"type": "img","name": "","img": ""}],"ps2": [{"size": [220, 150],"type": "img","name": "","img": ""},{"size": [170, 150],"type": "text","content": ""},{"size": [200, 150],"type": "img","name": "","img": ""},{"size": [120, 150],"type":"img","name":"","img":""}]};
*/

	// 六宫格
	var v = {
		"title": "",
		"ps1": [{
			"size": [150, 150],
			"type": "title",
			"title": "",
			"subTitle": ""
		},
		{
			"size": [260, 150],
			"type": "img",
			"name": "",
			"img": ""
		},
		{
			"size": [100, 150],
			"type": "img",
			"name": "",
			"img": ""
		}],
		"ps2": [{
			"size": [220, 150],
			"type": "img",
			"name": "",
			"img": ""
		},
		{
			"size": [170, 150],
			"type": "text",
			"content": ""
		},
		{
			"size": [120, 150],
			"type": "img",
			"name": "",
			"img": ""
		}]
	};

	for ( var i=0; i<g_data.length; i++ )
	{
		if ( g_cur_bid == g_data[i][0] )
		{
			var o = g_data[i][28].parseJSON();
			v.id = o.mid++;
			v.ps1[1].img = "http://112.124.55.78/building/" + g_cur_bid + "/img/hc/" + v.id + "_1.jpg";
			v.ps1[2].img = "http://112.124.55.78/building/" + g_cur_bid + "/img/hc/" + v.id + "_2.jpg";
			v.ps2[0].img = "http://112.124.55.78/building/" + g_cur_bid + "/img/hc/" + v.id + "_3.jpg";
			v.ps2[2].img = "http://112.124.55.78/building/" + g_cur_bid + "/img/hc/" + v.id + "_5.jpg";
			o.d.push(v);
			g_data[i][28] = o.toJSONString();
			g_cur_hcid = v.id;
			show_edit( v );
			init_hclist( g_cur_bid );
			break;
		}
	}
}

function del_hc(id)
{
	var o = get_hc_json();
	
	for ( var j=0; j<o.d.length; j++ )
	{
		if ( o.d[j].id == id )
		{
			o.d.splice(j,1);
			break;
		}
	}
	
	set_hc_json( o );
	
	init_hclist( g_cur_bid );
}

function do_commit()
{
	$("#fm").attr( "action", "commit_hc.php?id="+g_cur_bid );
	$("#fm").submit();
}

checkLogin();
init_header();
init_lplist();

</script>
